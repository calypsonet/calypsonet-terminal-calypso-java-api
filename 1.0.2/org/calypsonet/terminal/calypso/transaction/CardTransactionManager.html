<!DOCTYPE HTML>
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc -->
<title>CardTransactionManager (Calypsonet Terminal Calypso API - 1.0.2)</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<link rel="stylesheet" type="text/css" href="../../../../../keyple-stylesheet.css" title="Style">
<link rel="stylesheet" type="text/css" href="../../../../../jquery/jquery-ui.css" title="Style">
<script type="text/javascript" src="../../../../../script.js"></script>
<script type="text/javascript" src="../../../../../jquery/jszip/dist/jszip.min.js"></script>
<script type="text/javascript" src="../../../../../jquery/jszip-utils/dist/jszip-utils.min.js"></script>
<!--[if IE]>
<script type="text/javascript" src="../../../../../jquery/jszip-utils/dist/jszip-utils-ie.min.js"></script>
<![endif]-->
<script type="text/javascript" src="../../../../../jquery/jquery-3.5.1.js"></script>
<script type="text/javascript" src="../../../../../jquery/jquery-ui.js"></script>
</head>
<body>
<script type="text/javascript"><!--
    try {
        if (location.href.indexOf('is-external=true') == -1) {
            parent.document.title="CardTransactionManager (Calypsonet Terminal Calypso API - 1.0.2)";
        }
    }
    catch(err) {
    }
//-->
var data = {"i0":6,"i1":6,"i2":6,"i3":6,"i4":6,"i5":6,"i6":6,"i7":6,"i8":6,"i9":6,"i10":6,"i11":6,"i12":6,"i13":6,"i14":6,"i15":6,"i16":6,"i17":6,"i18":6,"i19":6,"i20":6,"i21":6,"i22":6,"i23":6,"i24":6,"i25":6,"i26":6,"i27":6,"i28":6,"i29":6,"i30":6,"i31":6};
var tabs = {65535:["t0","All Methods"],2:["t2","Instance Methods"],4:["t3","Abstract Methods"]};
var altColor = "altColor";
var rowColor = "rowColor";
var tableTab = "tableTab";
var activeTableTab = "activeTableTab";
var pathtoroot = "../../../../../";
var useModuleDirectories = false;
loadScripts(document, 'script');</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<header role="banner">
<nav role="navigation">
<div class="fixedNav">
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a id="navbar.top">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.top" title="Skip navigation links">Skip navigation links</a></div>
<a id="navbar.top.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../../index.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="class-use/CardTransactionManager.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../index-all.html">Index</a></li>
<li><a href="../../../../../help-doc.html">Help</a></li>
</ul>
<div class="aboutLanguage"><span></span><span style="line-height: 30px"> Calypsonet Terminal Calypso API - 1.0.2</span></div>
</div>
<div class="subNav">
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../../../../allclasses.html">All&nbsp;Classes</a></li>
</ul>
<ul class="navListSearch">
<li><label for="search">SEARCH:</label>
<input type="text" id="search" value="search" disabled="disabled">
<input type="reset" id="reset" value="reset" disabled="disabled">
</li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
<a id="skip.navbar.top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
</div>
<div class="navPadding">&nbsp;</div>
<script type="text/javascript"><!--
$('.navPadding').css('padding-top', $('.fixedNav').css("height"));
//-->
</script>
</nav>
</header>
<!-- ======== START OF CLASS DATA ======== -->
<main role="main">
<div class="header">
<div class="subTitle"><span class="packageLabelInType">Package</span>&nbsp;<a href="package-summary.html">org.calypsonet.terminal.calypso.transaction</a></div>
<h2 title="Interface CardTransactionManager" class="title">Interface CardTransactionManager</h2>
</div>
<div class="contentContainer">
<div class="description">
<ul class="blockList">
<li class="blockList">
<hr>
<pre>public interface <span class="typeNameLabel">CardTransactionManager</span></pre>
<div class="block">Service providing the high-level API to manage transactions with a Calypso card.

 <p>Depending on the type of operations required, the presence of a SAM may be necessary.

 <p>The <a href="../card/CalypsoCard.html" title="interface in org.calypsonet.terminal.calypso.card"><code>CalypsoCard</code></a> object provided to the build is kept and updated at each step of using
 the service. It is the main container of the data handled during the transaction and acts as a
 card image.

 <p>There are two main steps in using the methods of this service:

 <ul>
   <li>A command preparation step during which the application invokes prefixed "prepare" methods
       that will add to an internal list of commands to be executed by the card. The incoming data
       to the card are placed in <a href="../card/CalypsoCard.html" title="interface in org.calypsonet.terminal.calypso.card"><code>CalypsoCard</code></a>.
   <li>A processing step corresponding to the prefixed "process" methods, which will carry out the
       communications with the card and if necessary the SAM. The outgoing data from the card are
       placed in <a href="../card/CalypsoCard.html" title="interface in org.calypsonet.terminal.calypso.card"><code>CalypsoCard</code></a>.
 </ul>

 <p>Technical or data errors, security conditions, etc. are reported as exceptions.</div>
<dl>
<dt><span class="simpleTagLabel">Since:</span></dt>
<dd>1.0.0</dd>
</dl>
</li>
</ul>
</div>
<div class="summary">
<ul class="blockList">
<li class="blockList">
<!-- ========== METHOD SUMMARY =========== -->
<section role="region">
<ul class="blockList">
<li class="blockList"><a id="method.summary">
<!--   -->
</a>
<h3>Method Summary</h3>
<table class="memberSummary">
<caption><span id="t0" class="activeTableTab"><span>All Methods</span><span class="tabEnd">&nbsp;</span></span><span id="t2" class="tableTab"><span><a href="javascript:show(2);">Instance Methods</a></span><span class="tabEnd">&nbsp;</span></span><span id="t3" class="tableTab"><span><a href="javascript:show(4);">Abstract Methods</a></span><span class="tabEnd">&nbsp;</span></span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colSecond" scope="col">Method</th>
<th class="colLast" scope="col">Description</th>
</tr>
<tr id="i0" class="altColor">
<td class="colFirst"><code><a href="../card/CalypsoCard.html" title="interface in org.calypsonet.terminal.calypso.card">CalypsoCard</a></code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#getCalypsoCard()">getCalypsoCard</a></span>()</code></th>
<td class="colLast">
<div class="block">Gets the card on which the transaction is performed.</div>
</td>
</tr>
<tr id="i1" class="rowColor">
<td class="colFirst"><code>org.calypsonet.terminal.reader.CardReader</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#getCardReader()">getCardReader</a></span>()</code></th>
<td class="colLast">
<div class="block">Gets the reader used to communicate with the card on which the transaction is performed.</div>
</td>
</tr>
<tr id="i2" class="altColor">
<td class="colFirst"><code><a href="CardSecuritySetting.html" title="interface in org.calypsonet.terminal.calypso.transaction">CardSecuritySetting</a></code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#getCardSecuritySetting()">getCardSecuritySetting</a></span>()</code></th>
<td class="colLast">
<div class="block">Gets the settings defining the security parameters of the transaction.</div>
</td>
</tr>
<tr id="i3" class="rowColor">
<td class="colFirst"><code>java.lang.String</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#getTransactionAuditData()">getTransactionAuditData</a></span>()</code></th>
<td class="colLast">
<div class="block">Gets the audit data of the transaction.</div>
</td>
</tr>
<tr id="i4" class="altColor">
<td class="colFirst"><code><a href="CardTransactionManager.html" title="interface in org.calypsonet.terminal.calypso.transaction">CardTransactionManager</a></code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#prepareAppendRecord(byte,byte%5B%5D)">prepareAppendRecord</a></span>&#8203;(byte&nbsp;sfi,
                   byte[]&nbsp;recordData)</code></th>
<td class="colLast">
<div class="block">Schedules the execution of a <b>Append Record</b> command to adds the data provided in the
 indicated cyclic file.</div>
</td>
</tr>
<tr id="i5" class="rowColor">
<td class="colFirst"><code><a href="CardTransactionManager.html" title="interface in org.calypsonet.terminal.calypso.transaction">CardTransactionManager</a></code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#prepareCheckPinStatus()">prepareCheckPinStatus</a></span>()</code></th>
<td class="colLast">
<div class="block">Schedules the execution of a <b>Verify Pin</b> command without PIN presentation in order to get
 the attempt counter.</div>
</td>
</tr>
<tr id="i6" class="altColor">
<td class="colFirst"><code><a href="CardTransactionManager.html" title="interface in org.calypsonet.terminal.calypso.transaction">CardTransactionManager</a></code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#prepareDecreaseCounter(byte,int,int)">prepareDecreaseCounter</a></span>&#8203;(byte&nbsp;sfi,
                      int&nbsp;counterNumber,
                      int&nbsp;decValue)</code></th>
<td class="colLast">
<div class="block">Schedules the execution of a <b>Decrease command</b> command to decrease the target counter.</div>
</td>
</tr>
<tr id="i7" class="rowColor">
<td class="colFirst"><code><a href="CardTransactionManager.html" title="interface in org.calypsonet.terminal.calypso.transaction">CardTransactionManager</a></code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#prepareGetData(org.calypsonet.terminal.calypso.GetDataTag)">prepareGetData</a></span>&#8203;(<a href="../GetDataTag.html" title="enum in org.calypsonet.terminal.calypso">GetDataTag</a>&nbsp;tag)</code></th>
<td class="colLast">
<div class="block">Adds a command APDU to retrieve the data indicated by the provided tag.</div>
</td>
</tr>
<tr id="i8" class="altColor">
<td class="colFirst"><code><a href="CardTransactionManager.html" title="interface in org.calypsonet.terminal.calypso.transaction">CardTransactionManager</a></code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#prepareIncreaseCounter(byte,int,int)">prepareIncreaseCounter</a></span>&#8203;(byte&nbsp;sfi,
                      int&nbsp;counterNumber,
                      int&nbsp;incValue)</code></th>
<td class="colLast">
<div class="block">Schedules the execution of a <b>Increase command</b> command to increase the target counter.</div>
</td>
</tr>
<tr id="i9" class="rowColor">
<td class="colFirst"><code><a href="CardTransactionManager.html" title="interface in org.calypsonet.terminal.calypso.transaction">CardTransactionManager</a></code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#prepareInvalidate()">prepareInvalidate</a></span>()</code></th>
<td class="colLast">
<div class="block">Schedules the execution of a <b>Invalidate</b> command.</div>
</td>
</tr>
<tr id="i10" class="altColor">
<td class="colFirst"><code><a href="CardTransactionManager.html" title="interface in org.calypsonet.terminal.calypso.transaction">CardTransactionManager</a></code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#prepareReadCounterFile(byte,int)">prepareReadCounterFile</a></span>&#8203;(byte&nbsp;sfi,
                      int&nbsp;countersNumber)</code></th>
<td class="colLast">
<div class="block">Schedules the execution of a <b>Read Records</b> command to reads a record of the indicated EF,
 which should be a counter file.</div>
</td>
</tr>
<tr id="i11" class="rowColor">
<td class="colFirst"><code><a href="CardTransactionManager.html" title="interface in org.calypsonet.terminal.calypso.transaction">CardTransactionManager</a></code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#prepareReadRecordFile(byte,int)">prepareReadRecordFile</a></span>&#8203;(byte&nbsp;sfi,
                     int&nbsp;recordNumber)</code></th>
<td class="colLast">
<div class="block">Schedules the execution of a <b>Read Records</b> command to read a single record from the
 indicated EF.</div>
</td>
</tr>
<tr id="i12" class="altColor">
<td class="colFirst"><code><a href="CardTransactionManager.html" title="interface in org.calypsonet.terminal.calypso.transaction">CardTransactionManager</a></code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#prepareReadRecordFile(byte,int,int,int)">prepareReadRecordFile</a></span>&#8203;(byte&nbsp;sfi,
                     int&nbsp;firstRecordNumber,
                     int&nbsp;numberOfRecords,
                     int&nbsp;recordSize)</code></th>
<td class="colLast">
<div class="block">Schedules the execution of a <b>Read Records</b> command to read one or more records from the
 indicated EF.</div>
</td>
</tr>
<tr id="i13" class="rowColor">
<td class="colFirst"><code><a href="CardTransactionManager.html" title="interface in org.calypsonet.terminal.calypso.transaction">CardTransactionManager</a></code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#prepareRehabilitate()">prepareRehabilitate</a></span>()</code></th>
<td class="colLast">
<div class="block">Schedules the execution of a <b>Rehabilitate</b> command.</div>
</td>
</tr>
<tr id="i14" class="altColor">
<td class="colFirst"><code><a href="CardTransactionManager.html" title="interface in org.calypsonet.terminal.calypso.transaction">CardTransactionManager</a></code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#prepareReleaseCardChannel()">prepareReleaseCardChannel</a></span>()</code></th>
<td class="colLast">
<div class="block">Requests the closing of the card channel.</div>
</td>
</tr>
<tr id="i15" class="rowColor">
<td class="colFirst"><code><a href="CardTransactionManager.html" title="interface in org.calypsonet.terminal.calypso.transaction">CardTransactionManager</a></code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#prepareSelectFile(byte%5B%5D)">prepareSelectFile</a></span>&#8203;(byte[]&nbsp;lid)</code></th>
<td class="colLast">
<div class="block">Schedules the execution of a <b>Select File</b> command based on the file's LID.</div>
</td>
</tr>
<tr id="i16" class="altColor">
<td class="colFirst"><code><a href="CardTransactionManager.html" title="interface in org.calypsonet.terminal.calypso.transaction">CardTransactionManager</a></code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#prepareSelectFile(org.calypsonet.terminal.calypso.SelectFileControl)">prepareSelectFile</a></span>&#8203;(<a href="../SelectFileControl.html" title="enum in org.calypsonet.terminal.calypso">SelectFileControl</a>&nbsp;selectFileControl)</code></th>
<td class="colLast">
<div class="block">Schedules the execution of a <b>Select File</b> command using a navigation selectFileControl
 defined by the ISO standard.</div>
</td>
</tr>
<tr id="i17" class="rowColor">
<td class="colFirst"><code><a href="CardTransactionManager.html" title="interface in org.calypsonet.terminal.calypso.transaction">CardTransactionManager</a></code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#prepareSetCounter(byte,int,int)">prepareSetCounter</a></span>&#8203;(byte&nbsp;sfi,
                 int&nbsp;counterNumber,
                 int&nbsp;newValue)</code></th>
<td class="colLast">
<div class="block">Schedules the execution of a command to set the value of the target counter.</div>
</td>
</tr>
<tr id="i18" class="altColor">
<td class="colFirst"><code><a href="CardTransactionManager.html" title="interface in org.calypsonet.terminal.calypso.transaction">CardTransactionManager</a></code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#prepareSvDebit(int)">prepareSvDebit</a></span>&#8203;(int&nbsp;amount)</code></th>
<td class="colLast">
<div class="block">Schedules the execution of a <b>SV Debit</b> or <b>SV Undebit</b> command to increase the
 current SV balance or to partially or totally cancels the last SV debit command.</div>
</td>
</tr>
<tr id="i19" class="rowColor">
<td class="colFirst"><code><a href="CardTransactionManager.html" title="interface in org.calypsonet.terminal.calypso.transaction">CardTransactionManager</a></code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#prepareSvDebit(int,byte%5B%5D,byte%5B%5D)">prepareSvDebit</a></span>&#8203;(int&nbsp;amount,
              byte[]&nbsp;date,
              byte[]&nbsp;time)</code></th>
<td class="colLast">
<div class="block">Schedules the execution of a <b>SV Debit</b> or <b>SV Undebit</b> command to increase the
 current SV balance or to partially or totally cancels the last SV debit command and using the
 provided additional data.</div>
</td>
</tr>
<tr id="i20" class="altColor">
<td class="colFirst"><code><a href="CardTransactionManager.html" title="interface in org.calypsonet.terminal.calypso.transaction">CardTransactionManager</a></code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#prepareSvGet(org.calypsonet.terminal.calypso.transaction.SvOperation,org.calypsonet.terminal.calypso.transaction.SvAction)">prepareSvGet</a></span>&#8203;(<a href="SvOperation.html" title="enum in org.calypsonet.terminal.calypso.transaction">SvOperation</a>&nbsp;svOperation,
            <a href="SvAction.html" title="enum in org.calypsonet.terminal.calypso.transaction">SvAction</a>&nbsp;svAction)</code></th>
<td class="colLast">
<div class="block">Schedules the execution of a <b>SV Get</b> command to prepare an SV operation or simply
 retrieves the current SV status.</div>
</td>
</tr>
<tr id="i21" class="rowColor">
<td class="colFirst"><code><a href="CardTransactionManager.html" title="interface in org.calypsonet.terminal.calypso.transaction">CardTransactionManager</a></code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#prepareSvReadAllLogs()">prepareSvReadAllLogs</a></span>()</code></th>
<td class="colLast">
<div class="block">Schedules the execution of <b>Read Records</b> commands to read all SV logs.</div>
</td>
</tr>
<tr id="i22" class="altColor">
<td class="colFirst"><code><a href="CardTransactionManager.html" title="interface in org.calypsonet.terminal.calypso.transaction">CardTransactionManager</a></code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#prepareSvReload(int)">prepareSvReload</a></span>&#8203;(int&nbsp;amount)</code></th>
<td class="colLast">
<div class="block">Schedules the execution of a <b>SV Reload</b> command to increase the current SV balance.</div>
</td>
</tr>
<tr id="i23" class="rowColor">
<td class="colFirst"><code><a href="CardTransactionManager.html" title="interface in org.calypsonet.terminal.calypso.transaction">CardTransactionManager</a></code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#prepareSvReload(int,byte%5B%5D,byte%5B%5D,byte%5B%5D)">prepareSvReload</a></span>&#8203;(int&nbsp;amount,
               byte[]&nbsp;date,
               byte[]&nbsp;time,
               byte[]&nbsp;free)</code></th>
<td class="colLast">
<div class="block">Schedules the execution of a <b>SV Reload</b> command to increase the current SV balance and
 using the provided additional data.</div>
</td>
</tr>
<tr id="i24" class="altColor">
<td class="colFirst"><code><a href="CardTransactionManager.html" title="interface in org.calypsonet.terminal.calypso.transaction">CardTransactionManager</a></code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#prepareUpdateRecord(byte,int,byte%5B%5D)">prepareUpdateRecord</a></span>&#8203;(byte&nbsp;sfi,
                   int&nbsp;recordNumber,
                   byte[]&nbsp;recordData)</code></th>
<td class="colLast">
<div class="block">Schedules the execution of a <b>Update Record</b> command to overwrites the target file's
 record contents with the provided data.</div>
</td>
</tr>
<tr id="i25" class="rowColor">
<td class="colFirst"><code><a href="CardTransactionManager.html" title="interface in org.calypsonet.terminal.calypso.transaction">CardTransactionManager</a></code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#prepareWriteRecord(byte,int,byte%5B%5D)">prepareWriteRecord</a></span>&#8203;(byte&nbsp;sfi,
                  int&nbsp;recordNumber,
                  byte[]&nbsp;recordData)</code></th>
<td class="colLast">
<div class="block">Schedules the execution of a <b>Write Record</b> command to updates the target file's record
 contents with the result of a binary OR between the existing data and the provided data.</div>
</td>
</tr>
<tr id="i26" class="altColor">
<td class="colFirst"><code><a href="CardTransactionManager.html" title="interface in org.calypsonet.terminal.calypso.transaction">CardTransactionManager</a></code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#processCancel()">processCancel</a></span>()</code></th>
<td class="colLast">
<div class="block">Aborts a Secure Session.</div>
</td>
</tr>
<tr id="i27" class="rowColor">
<td class="colFirst"><code><a href="CardTransactionManager.html" title="interface in org.calypsonet.terminal.calypso.transaction">CardTransactionManager</a></code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#processCardCommands()">processCardCommands</a></span>()</code></th>
<td class="colLast">
<div class="block">Process all previously prepared card commands outside or inside a Secure Session.</div>
</td>
</tr>
<tr id="i28" class="altColor">
<td class="colFirst"><code><a href="CardTransactionManager.html" title="interface in org.calypsonet.terminal.calypso.transaction">CardTransactionManager</a></code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#processChangePin(byte%5B%5D)">processChangePin</a></span>&#8203;(byte[]&nbsp;newPin)</code></th>
<td class="colLast">
<div class="block">Replaces the current PIN with the new value provided.</div>
</td>
</tr>
<tr id="i29" class="rowColor">
<td class="colFirst"><code><a href="CardTransactionManager.html" title="interface in org.calypsonet.terminal.calypso.transaction">CardTransactionManager</a></code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#processClosing()">processClosing</a></span>()</code></th>
<td class="colLast">
<div class="block">Terminates the Secure Session sequence started with <a href="#processOpening(org.calypsonet.terminal.calypso.WriteAccessLevel)"><code>processOpening(WriteAccessLevel)</code></a>.</div>
</td>
</tr>
<tr id="i30" class="altColor">
<td class="colFirst"><code><a href="CardTransactionManager.html" title="interface in org.calypsonet.terminal.calypso.transaction">CardTransactionManager</a></code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#processOpening(org.calypsonet.terminal.calypso.WriteAccessLevel)">processOpening</a></span>&#8203;(<a href="../WriteAccessLevel.html" title="enum in org.calypsonet.terminal.calypso">WriteAccessLevel</a>&nbsp;writeAccessLevel)</code></th>
<td class="colLast">
<div class="block">Opens a Calypso Secure Session and then executes all previously prepared commands.</div>
</td>
</tr>
<tr id="i31" class="rowColor">
<td class="colFirst"><code><a href="CardTransactionManager.html" title="interface in org.calypsonet.terminal.calypso.transaction">CardTransactionManager</a></code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#processVerifyPin(byte%5B%5D)">processVerifyPin</a></span>&#8203;(byte[]&nbsp;pin)</code></th>
<td class="colLast">
<div class="block">Performs a PIN verification, in order to authenticate the card holder and/or unlock access to
 certain card files.</div>
</td>
</tr>
</table>
</li>
</ul>
</section>
</li>
</ul>
</div>
<div class="details">
<ul class="blockList">
<li class="blockList">
<!-- ============ METHOD DETAIL ========== -->
<section role="region">
<ul class="blockList">
<li class="blockList"><a id="method.detail">
<!--   -->
</a>
<h3>Method Detail</h3>
<a id="getCardReader()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getCardReader</h4>
<pre class="methodSignature">org.calypsonet.terminal.reader.CardReader&nbsp;getCardReader()</pre>
<div class="block">Gets the reader used to communicate with the card on which the transaction is performed.</div>
<dl>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>A not null reference.</dd>
<dt><span class="simpleTagLabel">Since:</span></dt>
<dd>1.0.0</dd>
</dl>
</li>
</ul>
<a id="getCalypsoCard()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getCalypsoCard</h4>
<pre class="methodSignature"><a href="../card/CalypsoCard.html" title="interface in org.calypsonet.terminal.calypso.card">CalypsoCard</a>&nbsp;getCalypsoCard()</pre>
<div class="block">Gets the card on which the transaction is performed.</div>
<dl>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>A not null <a href="../card/CalypsoCard.html" title="interface in org.calypsonet.terminal.calypso.card"><code>CalypsoCard</code></a> having a <a href="../card/CalypsoCard.ProductType.html" title="enum in org.calypsonet.terminal.calypso.card"><code>CalypsoCard.ProductType</code></a> different from
     <a href="../card/CalypsoCard.ProductType.html#UNKNOWN"><code>CalypsoCard.ProductType.UNKNOWN</code></a>.</dd>
<dt><span class="simpleTagLabel">Since:</span></dt>
<dd>1.0.0</dd>
</dl>
</li>
</ul>
<a id="getCardSecuritySetting()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getCardSecuritySetting</h4>
<pre class="methodSignature"><a href="CardSecuritySetting.html" title="interface in org.calypsonet.terminal.calypso.transaction">CardSecuritySetting</a>&nbsp;getCardSecuritySetting()</pre>
<div class="block">Gets the settings defining the security parameters of the transaction.</div>
<dl>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>Null if the transaction does not use security settings.</dd>
<dt><span class="simpleTagLabel">Since:</span></dt>
<dd>1.0.0</dd>
</dl>
</li>
</ul>
<a id="getTransactionAuditData()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getTransactionAuditData</h4>
<pre class="methodSignature">java.lang.String&nbsp;getTransactionAuditData()</pre>
<div class="block">Gets the audit data of the transaction.</div>
<dl>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>Null if there is no audit data.</dd>
<dt><span class="simpleTagLabel">Since:</span></dt>
<dd>1.0.0</dd>
</dl>
</li>
</ul>
<a id="prepareSelectFile(byte[])">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>prepareSelectFile</h4>
<pre class="methodSignature"><a href="CardTransactionManager.html" title="interface in org.calypsonet.terminal.calypso.transaction">CardTransactionManager</a>&nbsp;prepareSelectFile&#8203;(byte[]&nbsp;lid)</pre>
<div class="block">Schedules the execution of a <b>Select File</b> command based on the file's LID.

 <p>Once this command is processed, the result is available in <a href="../card/CalypsoCard.html" title="interface in org.calypsonet.terminal.calypso.card"><code>CalypsoCard</code></a> through the
 <a href="../card/CalypsoCard.html#getFileBySfi(byte)"><code>CalypsoCard.getFileBySfi(byte)</code></a> and <a href="../card/ElementaryFile.html#getHeader()"><code>ElementaryFile.getHeader()</code></a> methods.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>lid</code> - The LID of the EF to select.</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>The current instance.</dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code>java.lang.IllegalArgumentException</code> - If the provided lid is not 2 bytes long.</dd>
<dt><span class="simpleTagLabel">Since:</span></dt>
<dd>1.0.0</dd>
</dl>
</li>
</ul>
<a id="prepareSelectFile(org.calypsonet.terminal.calypso.SelectFileControl)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>prepareSelectFile</h4>
<pre class="methodSignature"><a href="CardTransactionManager.html" title="interface in org.calypsonet.terminal.calypso.transaction">CardTransactionManager</a>&nbsp;prepareSelectFile&#8203;(<a href="../SelectFileControl.html" title="enum in org.calypsonet.terminal.calypso">SelectFileControl</a>&nbsp;selectFileControl)</pre>
<div class="block">Schedules the execution of a <b>Select File</b> command using a navigation selectFileControl
 defined by the ISO standard.

 <p>Once this command is processed, the result is available in <a href="../card/CalypsoCard.html" title="interface in org.calypsonet.terminal.calypso.card"><code>CalypsoCard</code></a> through the
 <a href="../card/CalypsoCard.html#getFileBySfi(byte)"><code>CalypsoCard.getFileBySfi(byte)</code></a> and <a href="../card/ElementaryFile.html#getHeader()"><code>ElementaryFile.getHeader()</code></a> methods.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>selectFileControl</code> - A <a href="../SelectFileControl.html" title="enum in org.calypsonet.terminal.calypso"><code>SelectFileControl</code></a> enum entry.</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>The current instance.</dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code>java.lang.IllegalArgumentException</code> - If selectFileControl is null.</dd>
<dt><span class="simpleTagLabel">Since:</span></dt>
<dd>1.0.0</dd>
</dl>
</li>
</ul>
<a id="prepareGetData(org.calypsonet.terminal.calypso.GetDataTag)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>prepareGetData</h4>
<pre class="methodSignature"><a href="CardTransactionManager.html" title="interface in org.calypsonet.terminal.calypso.transaction">CardTransactionManager</a>&nbsp;prepareGetData&#8203;(<a href="../GetDataTag.html" title="enum in org.calypsonet.terminal.calypso">GetDataTag</a>&nbsp;tag)</pre>
<div class="block">Adds a command APDU to retrieve the data indicated by the provided tag.

 <p>The data returned by the command is used to update the current <a href="../card/CalypsoCard.html" title="interface in org.calypsonet.terminal.calypso.card"><code>CalypsoCard</code></a> object.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>tag</code> - The tag to use.</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>The object instance.</dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code>java.lang.IllegalArgumentException</code> - If tag is null.</dd>
<dd><code>java.lang.UnsupportedOperationException</code> - If the Get Data command with the provided tag is not
     supported.</dd>
<dt><span class="simpleTagLabel">Since:</span></dt>
<dd>1.0.0</dd>
</dl>
</li>
</ul>
<a id="prepareReadRecordFile(byte,int)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>prepareReadRecordFile</h4>
<pre class="methodSignature"><a href="CardTransactionManager.html" title="interface in org.calypsonet.terminal.calypso.transaction">CardTransactionManager</a>&nbsp;prepareReadRecordFile&#8203;(byte&nbsp;sfi,
                                             int&nbsp;recordNumber)</pre>
<div class="block">Schedules the execution of a <b>Read Records</b> command to read a single record from the
 indicated EF.

 <p>Once this command is processed, the result is available in <a href="../card/CalypsoCard.html" title="interface in org.calypsonet.terminal.calypso.card"><code>CalypsoCard</code></a>.

 <p>See the method <a href="../card/CalypsoCard.html#getFileBySfi(byte)"><code>CalypsoCard.getFileBySfi(byte)</code></a>, the objects <a href="../card/ElementaryFile.html" title="interface in org.calypsonet.terminal.calypso.card"><code>ElementaryFile</code></a>,
 <a href="../card/FileData.html" title="interface in org.calypsonet.terminal.calypso.card"><code>FileData</code></a> and their specialized methods according to the type of expected data: e.g.
 <a href="../card/FileData.html#getContent(int)"><code>FileData.getContent(int)</code></a>.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>sfi</code> - The SFI of the EF to read.</dd>
<dd><code>recordNumber</code> - The record number to read.</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>The current instance.</dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code>java.lang.IllegalArgumentException</code> - If one of the provided arguments is out of range.</dd>
<dt><span class="simpleTagLabel">Since:</span></dt>
<dd>1.0.0</dd>
</dl>
</li>
</ul>
<a id="prepareReadRecordFile(byte,int,int,int)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>prepareReadRecordFile</h4>
<pre class="methodSignature"><a href="CardTransactionManager.html" title="interface in org.calypsonet.terminal.calypso.transaction">CardTransactionManager</a>&nbsp;prepareReadRecordFile&#8203;(byte&nbsp;sfi,
                                             int&nbsp;firstRecordNumber,
                                             int&nbsp;numberOfRecords,
                                             int&nbsp;recordSize)</pre>
<div class="block">Schedules the execution of a <b>Read Records</b> command to read one or more records from the
 indicated EF.

 <p>Once this command is processed, the result is available in <a href="../card/CalypsoCard.html" title="interface in org.calypsonet.terminal.calypso.card"><code>CalypsoCard</code></a>.

 <p>See the method <a href="../card/CalypsoCard.html#getFileBySfi(byte)"><code>CalypsoCard.getFileBySfi(byte)</code></a>, the objects <a href="../card/ElementaryFile.html" title="interface in org.calypsonet.terminal.calypso.card"><code>ElementaryFile</code></a>,
 <a href="../card/FileData.html" title="interface in org.calypsonet.terminal.calypso.card"><code>FileData</code></a> and their specialized methods according to the type of expected data: e.g.
 <a href="../card/FileData.html#getContent()"><code>FileData.getContent()</code></a>.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>sfi</code> - The SFI of the EF.</dd>
<dd><code>firstRecordNumber</code> - The record number to read (or first record to read in case of several.
     records)</dd>
<dd><code>numberOfRecords</code> - The number of records expected.</dd>
<dd><code>recordSize</code> - The record length.</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>The current instance.</dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code>java.lang.IllegalArgumentException</code> - If one of the provided argument is out of range.</dd>
<dt><span class="simpleTagLabel">Since:</span></dt>
<dd>1.0.0</dd>
</dl>
</li>
</ul>
<a id="prepareReadCounterFile(byte,int)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>prepareReadCounterFile</h4>
<pre class="methodSignature"><a href="CardTransactionManager.html" title="interface in org.calypsonet.terminal.calypso.transaction">CardTransactionManager</a>&nbsp;prepareReadCounterFile&#8203;(byte&nbsp;sfi,
                                              int&nbsp;countersNumber)</pre>
<div class="block">Schedules the execution of a <b>Read Records</b> command to reads a record of the indicated EF,
 which should be a counter file.

 <p>The record will be read up to the counter location indicated in parameter.<br>
 Thus all previous counters will also be read.

 <p>Once this command is processed, the result is available in <a href="../card/CalypsoCard.html" title="interface in org.calypsonet.terminal.calypso.card"><code>CalypsoCard</code></a>.

 <p>See the method <a href="../card/CalypsoCard.html#getFileBySfi(byte)"><code>CalypsoCard.getFileBySfi(byte)</code></a>, the objects <a href="../card/ElementaryFile.html" title="interface in org.calypsonet.terminal.calypso.card"><code>ElementaryFile</code></a>,
 <a href="../card/FileData.html" title="interface in org.calypsonet.terminal.calypso.card"><code>FileData</code></a> and their specialized methods according to the type of expected data: e.g.
 <a href="../card/FileData.html#getAllCountersValue()"><code>FileData.getAllCountersValue()</code></a> (int)}.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>sfi</code> - The SFI of the EF.</dd>
<dd><code>countersNumber</code> - The number of the last counter to be read.</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>The current instance.</dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code>java.lang.IllegalArgumentException</code> - If one of the provided argument is out of range.</dd>
<dt><span class="simpleTagLabel">Since:</span></dt>
<dd>1.0.0</dd>
</dl>
</li>
</ul>
<a id="prepareCheckPinStatus()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>prepareCheckPinStatus</h4>
<pre class="methodSignature"><a href="CardTransactionManager.html" title="interface in org.calypsonet.terminal.calypso.transaction">CardTransactionManager</a>&nbsp;prepareCheckPinStatus()</pre>
<div class="block">Schedules the execution of a <b>Verify Pin</b> command without PIN presentation in order to get
 the attempt counter.

 <p>The PIN status will made available in CalypsoCard after the execution of process command.
 <br>
 Adds it to the list of commands to be sent with the next process command.

 <p>See <a href="../card/CalypsoCard.html#isPinBlocked()"><code>CalypsoCard.isPinBlocked()</code></a> and <a href="../card/CalypsoCard.html#getPinAttemptRemaining()"><code>CalypsoCard.getPinAttemptRemaining()</code></a> methods.</div>
<dl>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>The current instance.</dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code>java.lang.UnsupportedOperationException</code> - If the PIN feature is not available for this card.</dd>
<dt><span class="simpleTagLabel">Since:</span></dt>
<dd>1.0.0</dd>
</dl>
</li>
</ul>
<a id="prepareAppendRecord(byte,byte[])">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>prepareAppendRecord</h4>
<pre class="methodSignature"><a href="CardTransactionManager.html" title="interface in org.calypsonet.terminal.calypso.transaction">CardTransactionManager</a>&nbsp;prepareAppendRecord&#8203;(byte&nbsp;sfi,
                                           byte[]&nbsp;recordData)</pre>
<div class="block">Schedules the execution of a <b>Append Record</b> command to adds the data provided in the
 indicated cyclic file.

 <p>A new record is added, the oldest record is deleted.

 <p>Note: <a href="../card/CalypsoCard.html" title="interface in org.calypsonet.terminal.calypso.card"><code>CalypsoCard</code></a> is filled with the provided input data.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>sfi</code> - The sfi to select.</dd>
<dd><code>recordData</code> - The new record data to write.</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>The current instance.</dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code>java.lang.IllegalArgumentException</code> - If one of the provided argument is out of range.</dd>
<dt><span class="simpleTagLabel">Since:</span></dt>
<dd>1.0.0</dd>
</dl>
</li>
</ul>
<a id="prepareUpdateRecord(byte,int,byte[])">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>prepareUpdateRecord</h4>
<pre class="methodSignature"><a href="CardTransactionManager.html" title="interface in org.calypsonet.terminal.calypso.transaction">CardTransactionManager</a>&nbsp;prepareUpdateRecord&#8203;(byte&nbsp;sfi,
                                           int&nbsp;recordNumber,
                                           byte[]&nbsp;recordData)</pre>
<div class="block">Schedules the execution of a <b>Update Record</b> command to overwrites the target file's
 record contents with the provided data.

 <p>If the input data is shorter than the record size, only the first bytes will be overwritten.

 <p>Note: <a href="../card/CalypsoCard.html" title="interface in org.calypsonet.terminal.calypso.card"><code>CalypsoCard</code></a> is filled with the provided input data.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>sfi</code> - The sfi to select.</dd>
<dd><code>recordNumber</code> - The record number to update.</dd>
<dd><code>recordData</code> - The new record data. If length <code>&lt;</code> RecSize, bytes beyond length are.
     left unchanged.</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>The current instance.</dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code>java.lang.IllegalArgumentException</code> - If one of the provided argument is out of range.</dd>
<dt><span class="simpleTagLabel">Since:</span></dt>
<dd>1.0.0</dd>
</dl>
</li>
</ul>
<a id="prepareWriteRecord(byte,int,byte[])">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>prepareWriteRecord</h4>
<pre class="methodSignature"><a href="CardTransactionManager.html" title="interface in org.calypsonet.terminal.calypso.transaction">CardTransactionManager</a>&nbsp;prepareWriteRecord&#8203;(byte&nbsp;sfi,
                                          int&nbsp;recordNumber,
                                          byte[]&nbsp;recordData)</pre>
<div class="block">Schedules the execution of a <b>Write Record</b> command to updates the target file's record
 contents with the result of a binary OR between the existing data and the provided data.

 <p>If the input data is shorter than the record size, only the first bytes will be overwritten.

 <p>Note: <a href="../card/CalypsoCard.html" title="interface in org.calypsonet.terminal.calypso.card"><code>CalypsoCard</code></a> is filled with the provided input data.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>sfi</code> - The sfi to select.</dd>
<dd><code>recordNumber</code> - The record number to write.</dd>
<dd><code>recordData</code> - The data to overwrite in the record. If length <code>&lt;</code> RecSize, bytes.
     beyond length are left unchanged.</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>The current instance.</dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code>java.lang.IllegalArgumentException</code> - If one of the provided argument is out of range.</dd>
<dt><span class="simpleTagLabel">Since:</span></dt>
<dd>1.0.0</dd>
</dl>
</li>
</ul>
<a id="prepareIncreaseCounter(byte,int,int)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>prepareIncreaseCounter</h4>
<pre class="methodSignature"><a href="CardTransactionManager.html" title="interface in org.calypsonet.terminal.calypso.transaction">CardTransactionManager</a>&nbsp;prepareIncreaseCounter&#8203;(byte&nbsp;sfi,
                                              int&nbsp;counterNumber,
                                              int&nbsp;incValue)</pre>
<div class="block">Schedules the execution of a <b>Increase command</b> command to increase the target counter.

 <p>Note: <a href="../card/CalypsoCard.html" title="interface in org.calypsonet.terminal.calypso.card"><code>CalypsoCard</code></a> is filled with the provided input data.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>counterNumber</code> - <code>&gt;=</code> 01h: Counters file, number of the counter. 00h: Simulated.
     Counter file.</dd>
<dd><code>sfi</code> - SFI of the file to select or 00h for current EF.</dd>
<dd><code>incValue</code> - Value to add to the counter (defined as a positive int <code>&lt;=</code> 16777215
     [FFFFFFh])</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>The current instance.</dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code>java.lang.IllegalArgumentException</code> - If one of the provided argument is out of range.</dd>
<dt><span class="simpleTagLabel">Since:</span></dt>
<dd>1.0.0</dd>
</dl>
</li>
</ul>
<a id="prepareDecreaseCounter(byte,int,int)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>prepareDecreaseCounter</h4>
<pre class="methodSignature"><a href="CardTransactionManager.html" title="interface in org.calypsonet.terminal.calypso.transaction">CardTransactionManager</a>&nbsp;prepareDecreaseCounter&#8203;(byte&nbsp;sfi,
                                              int&nbsp;counterNumber,
                                              int&nbsp;decValue)</pre>
<div class="block">Schedules the execution of a <b>Decrease command</b> command to decrease the target counter.

 <p>Note: <a href="../card/CalypsoCard.html" title="interface in org.calypsonet.terminal.calypso.card"><code>CalypsoCard</code></a> is filled with the provided input data.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>counterNumber</code> - <code>&gt;=</code> 01h: Counters file, number of the counter. 00h: Simulated.
     Counter file.</dd>
<dd><code>sfi</code> - SFI of the file to select or 00h for current EF.</dd>
<dd><code>decValue</code> - Value to subtract to the counter (defined as a positive int <code>&lt;=</code> 16777215
     [FFFFFFh])</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>The current instance.</dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code>java.lang.IllegalArgumentException</code> - If one of the provided argument is out of range.</dd>
<dt><span class="simpleTagLabel">Since:</span></dt>
<dd>1.0.0</dd>
</dl>
</li>
</ul>
<a id="prepareSetCounter(byte,int,int)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>prepareSetCounter</h4>
<pre class="methodSignature"><a href="CardTransactionManager.html" title="interface in org.calypsonet.terminal.calypso.transaction">CardTransactionManager</a>&nbsp;prepareSetCounter&#8203;(byte&nbsp;sfi,
                                         int&nbsp;counterNumber,
                                         int&nbsp;newValue)</pre>
<div class="block">Schedules the execution of a command to set the value of the target counter.

 <p>It builds an Increase or Decrease command and add it to the list of commands to be sent with
 the next <b>process</b> command in order to set the target counter to the specified value.<br>
 The operation (Increase or Decrease) is selected according to whether the difference between
 the current value and the desired value is negative (Increase) or positive (Decrease).

 <p>Note: it is assumed here that:<br>

 <ul>
   <li>the counter value has been read before,
   <li>the type of session (and associated access rights) is consistent with the requested
       operation: reload session if the counter is to be incremented, debit if it is to be
       decremented.<br>
       No control is performed on this point by this method; the closing of the session will
       determine the success of the operation..
 </ul></div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>counterNumber</code> - <code>&gt;=</code> 01h: Counters file, number of the counter. 00h: Simulated.
     Counter file.</dd>
<dd><code>sfi</code> - SFI of the file to select or 00h for current EF.</dd>
<dd><code>newValue</code> - The desired value for the counter (defined as a positive int <code>&lt;=</code>
     16777215 [FFFFFFh])</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>The current instance.</dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code>java.lang.IllegalArgumentException</code> - If one of the provided argument is out of range.</dd>
<dd><code>java.lang.IllegalStateException</code> - If the current counter value is unknown.</dd>
<dt><span class="simpleTagLabel">Since:</span></dt>
<dd>1.0.0</dd>
</dl>
</li>
</ul>
<a id="prepareSvGet(org.calypsonet.terminal.calypso.transaction.SvOperation,org.calypsonet.terminal.calypso.transaction.SvAction)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>prepareSvGet</h4>
<pre class="methodSignature"><a href="CardTransactionManager.html" title="interface in org.calypsonet.terminal.calypso.transaction">CardTransactionManager</a>&nbsp;prepareSvGet&#8203;(<a href="SvOperation.html" title="enum in org.calypsonet.terminal.calypso.transaction">SvOperation</a>&nbsp;svOperation,
                                    <a href="SvAction.html" title="enum in org.calypsonet.terminal.calypso.transaction">SvAction</a>&nbsp;svAction)</pre>
<div class="block">Schedules the execution of a <b>SV Get</b> command to prepare an SV operation or simply
 retrieves the current SV status.

 <p>Once this command is processed, the result is available in <a href="../card/CalypsoCard.html" title="interface in org.calypsonet.terminal.calypso.card"><code>CalypsoCard</code></a>.

 <p>See the methods <a href="../card/CalypsoCard.html#getSvBalance()"><code>CalypsoCard.getSvBalance()</code></a>, <a href="../card/CalypsoCard.html#getSvLoadLogRecord()"><code>CalypsoCard.getSvLoadLogRecord()</code></a>
 ()}, <a href="../card/CalypsoCard.html#getSvDebitLogLastRecord()"><code>CalypsoCard.getSvDebitLogLastRecord()</code></a>, <a href="../card/CalypsoCard.html#getSvDebitLogAllRecords()"><code>CalypsoCard.getSvDebitLogAllRecords()</code></a>.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>svOperation</code> - Informs about the nature of the intended operation: debit or reload.</dd>
<dd><code>svAction</code> - The type of action: DO a debit or a positive reload, UNDO an undebit or a.
     negative reload</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>The current instance.</dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code>java.lang.IllegalArgumentException</code> - If one of the arguments is null.</dd>
<dd><code>java.lang.UnsupportedOperationException</code> - If the SV feature is not available for this card.</dd>
<dt><span class="simpleTagLabel">Since:</span></dt>
<dd>1.0.0</dd>
</dl>
</li>
</ul>
<a id="prepareSvReload(int,byte[],byte[],byte[])">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>prepareSvReload</h4>
<pre class="methodSignature"><a href="CardTransactionManager.html" title="interface in org.calypsonet.terminal.calypso.transaction">CardTransactionManager</a>&nbsp;prepareSvReload&#8203;(int&nbsp;amount,
                                       byte[]&nbsp;date,
                                       byte[]&nbsp;time,
                                       byte[]&nbsp;free)</pre>
<div class="block">Schedules the execution of a <b>SV Reload</b> command to increase the current SV balance and
 using the provided additional data.

 <p>Note #1: a communication with the SAM is done here.

 <p>Note #2: the key used is the reload key.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>amount</code> - The value to be reloaded, positive or negative integer in the range.
     -8388608..8388607</dd>
<dd><code>date</code> - 2-byte free value.</dd>
<dd><code>time</code> - 2-byte free value.</dd>
<dd><code>free</code> - 2-byte free value.</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>The current instance.</dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code>java.lang.IllegalArgumentException</code> - If one of the provided argument is out of range.</dd>
<dd><code>java.lang.UnsupportedOperationException</code> - If the SV feature is not available for this card.</dd>
<dd><code><a href="CardTransactionException.html" title="class in org.calypsonet.terminal.calypso.transaction">CardTransactionException</a></code> - If a functional error occurs (including card and SAM IO
     errors)</dd>
<dt><span class="simpleTagLabel">Since:</span></dt>
<dd>1.0.0</dd>
</dl>
</li>
</ul>
<a id="prepareSvReload(int)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>prepareSvReload</h4>
<pre class="methodSignature"><a href="CardTransactionManager.html" title="interface in org.calypsonet.terminal.calypso.transaction">CardTransactionManager</a>&nbsp;prepareSvReload&#8203;(int&nbsp;amount)</pre>
<div class="block">Schedules the execution of a <b>SV Reload</b> command to increase the current SV balance.

 <p>Note #1: the optional SV additional data are set to zero.

 <p>Note #2: a communication with the SAM is done here.

 <p>Note #3: the key used is the reload key.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>amount</code> - The value to be reloaded, positive integer in the range 0..8388607 for a DO.
     action, in the range 0..8388608 for an UNDO action.</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>The current instance.</dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code>java.lang.IllegalArgumentException</code> - If the provided argument is out of range.</dd>
<dd><code>java.lang.UnsupportedOperationException</code> - If the SV feature is not available for this card.</dd>
<dd><code><a href="CardTransactionException.html" title="class in org.calypsonet.terminal.calypso.transaction">CardTransactionException</a></code> - If a functional error occurs (including card and SAM IO
     errors)</dd>
<dt><span class="simpleTagLabel">Since:</span></dt>
<dd>1.0.0</dd>
</dl>
</li>
</ul>
<a id="prepareSvDebit(int,byte[],byte[])">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>prepareSvDebit</h4>
<pre class="methodSignature"><a href="CardTransactionManager.html" title="interface in org.calypsonet.terminal.calypso.transaction">CardTransactionManager</a>&nbsp;prepareSvDebit&#8203;(int&nbsp;amount,
                                      byte[]&nbsp;date,
                                      byte[]&nbsp;time)</pre>
<div class="block">Schedules the execution of a <b>SV Debit</b> or <b>SV Undebit</b> command to increase the
 current SV balance or to partially or totally cancels the last SV debit command and using the
 provided additional data.

 <p>It consists in decreasing the current balance of the SV by a certain amount or canceling a
 previous debit according to the type operation chosen in when invoking the previous SV Get
 command.

 <p>Note #1: a communication with the SAM is done here.

 <p>Note #2: the key used is the reload key.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>amount</code> - The amount to be subtracted or added, positive integer in the range 0..32767 when
     subtracted and 0..32768 when added.</dd>
<dd><code>date</code> - 2-byte free value.</dd>
<dd><code>time</code> - 2-byte free value.</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>The current instance.</dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code>java.lang.IllegalArgumentException</code> - If one of the provided argument is out of range.</dd>
<dt><span class="simpleTagLabel">Since:</span></dt>
<dd>1.0.0</dd>
</dl>
</li>
</ul>
<a id="prepareSvDebit(int)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>prepareSvDebit</h4>
<pre class="methodSignature"><a href="CardTransactionManager.html" title="interface in org.calypsonet.terminal.calypso.transaction">CardTransactionManager</a>&nbsp;prepareSvDebit&#8203;(int&nbsp;amount)</pre>
<div class="block">Schedules the execution of a <b>SV Debit</b> or <b>SV Undebit</b> command to increase the
 current SV balance or to partially or totally cancels the last SV debit command.

 <p>It consists in decreasing the current balance of the SV by a certain amount or canceling a
 previous debit.

 <p>Note #1: the optional SV additional data are set to zero.

 <p>Note #2: a communication with the SAM is done here.

 <p>Note #3: the key used is the reload key.The information fields such as date and time are set
 to 0. The extraInfo field propagated in Logs are automatically generated with the type of
 transaction and amount.

 <p>Note #4: operations that would result in a negative balance are forbidden (SV Exception
 raised).

 <p>Note #5: the key used is the debit key</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>amount</code> - The amount to be subtracted or added, positive integer in the range 0..32767 when
     subtracted and 0..32768 when added.</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>The current instance.</dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code>java.lang.IllegalArgumentException</code> - If one of the provided argument is out of range.</dd>
<dt><span class="simpleTagLabel">Since:</span></dt>
<dd>1.0.0</dd>
</dl>
</li>
</ul>
<a id="prepareSvReadAllLogs()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>prepareSvReadAllLogs</h4>
<pre class="methodSignature"><a href="CardTransactionManager.html" title="interface in org.calypsonet.terminal.calypso.transaction">CardTransactionManager</a>&nbsp;prepareSvReadAllLogs()</pre>
<div class="block">Schedules the execution of <b>Read Records</b> commands to read all SV logs.

 <p>Note: this method requires that the selected application is of type Store Value (file
 structure 20h).

 <p>The SV transaction logs are contained in two files with fixed identifiers:

 <ul>
   <li>The file whose SFI is 14h contains 1 record containing the unique reload log.
   <li>The file whose SFI is 15h contains 3 records containing the last three debit logs.
 </ul>

 <p>At the end of this reading operation, the data will be accessible in <a href="../card/CalypsoCard.html" title="interface in org.calypsonet.terminal.calypso.card"><code>CalypsoCard</code></a> in
 raw format via the standard commands for accessing read files or in the form of dedicated
 objects (see <a href="../card/CalypsoCard.html#getSvLoadLogRecord()"><code>CalypsoCard.getSvLoadLogRecord()</code></a> and <a href="../card/CalypsoCard.html#getSvDebitLogAllRecords()"><code>CalypsoCard.getSvDebitLogAllRecords()</code></a>).

 <p>See the methods <a href="../card/CalypsoCard.html#getSvBalance()"><code>CalypsoCard.getSvBalance()</code></a>, <a href="../card/CalypsoCard.html#getSvLoadLogRecord()"><code>CalypsoCard.getSvLoadLogRecord()</code></a>
 ()}, <a href="../card/CalypsoCard.html#getSvDebitLogLastRecord()"><code>CalypsoCard.getSvDebitLogLastRecord()</code></a>, <a href="../card/CalypsoCard.html#getSvDebitLogAllRecords()"><code>CalypsoCard.getSvDebitLogAllRecords()</code></a>.</div>
<dl>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>The current instance.</dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code>java.lang.UnsupportedOperationException</code> - If the application is not of type Stored Value.</dd>
<dt><span class="simpleTagLabel">Since:</span></dt>
<dd>1.0.0</dd>
</dl>
</li>
</ul>
<a id="prepareInvalidate()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>prepareInvalidate</h4>
<pre class="methodSignature"><a href="CardTransactionManager.html" title="interface in org.calypsonet.terminal.calypso.transaction">CardTransactionManager</a>&nbsp;prepareInvalidate()</pre>
<div class="block">Schedules the execution of a <b>Invalidate</b> command.

 <p>This command is usually executed within a secure session with the DEBIT key (depends on the
 access rights given to this command in the file structure of the card).</div>
<dl>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>The current instance.</dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code>java.lang.IllegalStateException</code> - If the card is already invalidated.</dd>
<dt><span class="simpleTagLabel">Since:</span></dt>
<dd>1.0.0</dd>
</dl>
</li>
</ul>
<a id="prepareRehabilitate()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>prepareRehabilitate</h4>
<pre class="methodSignature"><a href="CardTransactionManager.html" title="interface in org.calypsonet.terminal.calypso.transaction">CardTransactionManager</a>&nbsp;prepareRehabilitate()</pre>
<div class="block">Schedules the execution of a <b>Rehabilitate</b> command.

 <p>This command is usually executed within a secure session with the PERSONALIZATION key
 (depends on the access rights given to this command in the file structure of the card).</div>
<dl>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>The current instance.</dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code>java.lang.IllegalStateException</code> - If the card is not invalidated.</dd>
<dt><span class="simpleTagLabel">Since:</span></dt>
<dd>1.0.0</dd>
</dl>
</li>
</ul>
<a id="prepareReleaseCardChannel()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>prepareReleaseCardChannel</h4>
<pre class="methodSignature"><a href="CardTransactionManager.html" title="interface in org.calypsonet.terminal.calypso.transaction">CardTransactionManager</a>&nbsp;prepareReleaseCardChannel()</pre>
<div class="block">Requests the closing of the card channel.

 <p>If this command is called before a "process" command (except for processOpening) then the
 last transmission to the card will be associated with the indication CLOSE_AFTER in order to
 close the card channel.

 <p>Note: this command must imperatively be called at the end of any transaction, whether it
 ended normally or not.

 <p>In case the transaction was interrupted (exception), an additional invocation of
 processCardCommands must be made to effectively close the channel.</div>
<dl>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>The current instance.</dd>
<dt><span class="simpleTagLabel">Since:</span></dt>
<dd>1.0.0</dd>
</dl>
</li>
</ul>
<a id="processCardCommands()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>processCardCommands</h4>
<pre class="methodSignature"><a href="CardTransactionManager.html" title="interface in org.calypsonet.terminal.calypso.transaction">CardTransactionManager</a>&nbsp;processCardCommands()</pre>
<div class="block">Process all previously prepared card commands outside or inside a Secure Session.

 <ul>
   <li>All APDUs resulting from prepared commands are grouped and sent to the card.
   <li>The <a href="../card/CalypsoCard.html" title="interface in org.calypsonet.terminal.calypso.card"><code>CalypsoCard</code></a> object is updated with the result of the executed commands.
   <li>If a secure session is opened, except in the case where reloading or debit SV operations
       have been prepared, the invocation of this method does not generate communication with
       the SAM. The data necessary for the calculation of the terminal signature are kept to be
       sent to the SAM at the time of the invocation of <a href="#processClosing()"><code>processClosing()</code></a>.<br>
       The card channel is kept open.
   <li>If no secure session is opened, the card channel is closed depending on whether or not
       prepareReleaseCardChannel has been called.
   <li>The card session buffer overflows are managed in the same way as in <a href="#processOpening(org.calypsonet.terminal.calypso.WriteAccessLevel)"><code>processOpening(org.calypsonet.terminal.calypso.WriteAccessLevel)</code></a>. For example, when the
       multiple session mode is enabled, the commands are separated in as many sessions as
       necessary to respect the capacity of the card buffer.
 </ul></div>
<dl>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>The current instance.</dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code><a href="CardTransactionException.html" title="class in org.calypsonet.terminal.calypso.transaction">CardTransactionException</a></code> - If a functional error occurs (including card and SAM IO
     errors)</dd>
<dt><span class="simpleTagLabel">Since:</span></dt>
<dd>1.0.0</dd>
</dl>
</li>
</ul>
<a id="processVerifyPin(byte[])">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>processVerifyPin</h4>
<pre class="methodSignature"><a href="CardTransactionManager.html" title="interface in org.calypsonet.terminal.calypso.transaction">CardTransactionManager</a>&nbsp;processVerifyPin&#8203;(byte[]&nbsp;pin)</pre>
<div class="block">Performs a PIN verification, in order to authenticate the card holder and/or unlock access to
 certain card files.

 <p>This command can be performed both in and out of a secure session. The PIN code can be
 transmitted in plain text or encrypted according to the parameter set in CardSecuritySetting
 (by default the transmission is encrypted).

 <p>If the execution is done out of session but an encrypted transmission is requested, then
 CardTransactionManager must be constructed with <a href="CardSecuritySetting.html" title="interface in org.calypsonet.terminal.calypso.transaction"><code>CardSecuritySetting</code></a>

 <p>If CardTransactionManager is constructed without <a href="CardSecuritySetting.html" title="interface in org.calypsonet.terminal.calypso.transaction"><code>CardSecuritySetting</code></a> the
 transmission in done in plain.

 <p>The card channel is closed if prepareReleaseCardChannel is called before this command.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>pin</code> - The PIN code value (4-byte long byte array).</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>The current instance.</dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code>java.lang.UnsupportedOperationException</code> - If the PIN feature is not available for this card</dd>
<dd><code>java.lang.IllegalArgumentException</code> - If the provided argument is out of range.</dd>
<dd><code>java.lang.IllegalStateException</code> - If commands have been prepared before invoking this process
     method.</dd>
<dd><code><a href="CardTransactionException.html" title="class in org.calypsonet.terminal.calypso.transaction">CardTransactionException</a></code> - If a functional error occurs (including card and SAM IO
     errors)</dd>
<dt><span class="simpleTagLabel">Since:</span></dt>
<dd>1.0.0</dd>
</dl>
</li>
</ul>
<a id="processChangePin(byte[])">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>processChangePin</h4>
<pre class="methodSignature"><a href="CardTransactionManager.html" title="interface in org.calypsonet.terminal.calypso.transaction">CardTransactionManager</a>&nbsp;processChangePin&#8203;(byte[]&nbsp;newPin)</pre>
<div class="block">Replaces the current PIN with the new value provided.

 <p>This command can be performed only out of a secure session. The new PIN code can be
 transmitted in plain text or encrypted according to the parameter set in CardSecuritySetting
 (by default the transmission is encrypted).

 <p>When the PIN is transmitted plain, this command must be preceded by a successful Verify PIN
 command (see <a href="#processVerifyPin(byte%5B%5D)"><code>processVerifyPin(byte[])</code></a>).</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>newPin</code> - The new PIN code value (4-byte long byte array).</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>The current instance.</dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code>java.lang.UnsupportedOperationException</code> - If the PIN feature is not available for this card</dd>
<dd><code>java.lang.IllegalArgumentException</code> - If the provided argument is out of range.</dd>
<dd><code>java.lang.IllegalStateException</code> - If the command is executed while a secure session is open.</dd>
<dd><code><a href="CardTransactionException.html" title="class in org.calypsonet.terminal.calypso.transaction">CardTransactionException</a></code> - If a functional error occurs (including card and SAM IO
     errors)</dd>
<dt><span class="simpleTagLabel">Since:</span></dt>
<dd>1.0.0</dd>
</dl>
</li>
</ul>
<a id="processOpening(org.calypsonet.terminal.calypso.WriteAccessLevel)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>processOpening</h4>
<pre class="methodSignature"><a href="CardTransactionManager.html" title="interface in org.calypsonet.terminal.calypso.transaction">CardTransactionManager</a>&nbsp;processOpening&#8203;(<a href="../WriteAccessLevel.html" title="enum in org.calypsonet.terminal.calypso">WriteAccessLevel</a>&nbsp;writeAccessLevel)</pre>
<div class="block">Opens a Calypso Secure Session and then executes all previously prepared commands.

 <p>It is the starting point of the sequence:

 <ul>
   <li><a href="#processOpening(org.calypsonet.terminal.calypso.WriteAccessLevel)"><code>processOpening(WriteAccessLevel)</code></a>
   <li>[<a href="#processCardCommands()"><code>processCardCommands()</code></a>]
   <li>[...]
   <li>[<a href="#processCardCommands()"><code>processCardCommands()</code></a>]
   <li><a href="#processClosing()"><code>processClosing()</code></a>
 </ul>

 <p>Each of the steps in this sequence may or may not be preceded by the preparation of one or
 more commands and ends with an update of the <a href="../card/CalypsoCard.html" title="interface in org.calypsonet.terminal.calypso.card"><code>CalypsoCard</code></a> object provided when
 CardTransactionManager was created.

 <p>As a prerequisite for invoking this method, since the Calypso Secure Session involves the
 use of a SAM, the CardTransactionManager must have been built in secure mode, i.e. the
 constructor used must be the one expecting a reference to a valid <a href="CardSecuritySetting.html" title="interface in org.calypsonet.terminal.calypso.transaction"><code>CardSecuritySetting</code></a>
 object, otherwise a <code>IllegalStateException</code> is raised.

 <p>The secure session is opened with the <a href="../WriteAccessLevel.html" title="enum in org.calypsonet.terminal.calypso"><code>WriteAccessLevel</code></a> passed as an argument
 depending on whether it is a personalization, reload or debit transaction profile..

 <p>The possible overflow of the internal session buffer of the card is managed in two ways
 depending on the setting chosen in <a href="CardSecuritySetting.html" title="interface in org.calypsonet.terminal.calypso.transaction"><code>CardSecuritySetting</code></a>.

 <ul>
   <li>If the session was opened with the default atomic mode and the previously prepared
       commands will cause the buffer to be exceeded, then an <a href="AtomicTransactionException.html" title="class in org.calypsonet.terminal.calypso.transaction"><code>AtomicTransactionException</code></a>
       is raised and no transmission to the card is made. <br>
   <li>If the session was opened with the multiple session mode and the buffer is to be exceeded
       then a split into several secure sessions is performed automatically. However, regardless
       of the number of intermediate sessions performed, a secure session is opened at the end
       of the execution of this method.
 </ul>

 <p>Be aware that in the "MULTIPLE" case we lose the benefit of the atomicity of the secure
 session.

 <p><b>Card and SAM exchanges in detail</b>

 <p>When executing this method, communications with the card and the SAM are (in that order) :

 <ul>
   <li>Sending the card diversifier (Calypso card serial number) to the SAM and receiving the
       terminal challenge
   <li>Grouped sending to the card of
       <ul>
         <li>the open secure session command including the challenge terminal.
         <li>all previously prepared commands
       </ul>
   <li>Receiving grouped responses and updating <a href="../card/CalypsoCard.html" title="interface in org.calypsonet.terminal.calypso.card"><code>CalypsoCard</code></a> with the collected data.
 </ul>

 For optimization purposes, if the first command prepared is the reading of a single record of a
 card file then this one is replaced by a setting of the session opening command allowing the
 retrieval of this data in response to this command.

 <p><b>Other operations carried out</b>

 <ul>
   <li>The card KIF, KVC and card challenge received in response to the open secure session
       command are kept for a later initialization of the session's digest (see <a href="#processClosing()"><code>processClosing()</code></a>).
   <li>All data received in response to the open secure session command and the responses to the
       prepared commands are also stored for later calculation of the digest.
   <li>If a list of authorized KVCs has been defined in <a href="CardSecuritySetting.html" title="interface in org.calypsonet.terminal.calypso.transaction"><code>CardSecuritySetting</code></a> and the KVC
       of the card does not belong to this list then a <a href="UnauthorizedKeyException.html" title="class in org.calypsonet.terminal.calypso.transaction"><code>UnauthorizedKeyException</code></a> is
       thrown.
 </ul>

 <p>All unexpected results (communication errors, data or security errors, etc. are notified to
 the calling application through dedicated exceptions.

 <p><i>Note: to understand in detail how the secure session works please refer to the card
 specification documents.</i></div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>writeAccessLevel</code> - An <a href="../WriteAccessLevel.html" title="enum in org.calypsonet.terminal.calypso"><code>WriteAccessLevel</code></a> enum entry.</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>The current instance.</dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code>java.lang.IllegalArgumentException</code> - If the provided argument is null.</dd>
<dd><code>java.lang.IllegalStateException</code> - If no <a href="CardSecuritySetting.html" title="interface in org.calypsonet.terminal.calypso.transaction"><code>CardSecuritySetting</code></a> is available</dd>
<dd><code><a href="CardTransactionException.html" title="class in org.calypsonet.terminal.calypso.transaction">CardTransactionException</a></code> - If a functional error occurs (including card and SAM IO
     errors)</dd>
<dt><span class="simpleTagLabel">Since:</span></dt>
<dd>1.0.0</dd>
</dl>
</li>
</ul>
<a id="processClosing()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>processClosing</h4>
<pre class="methodSignature"><a href="CardTransactionManager.html" title="interface in org.calypsonet.terminal.calypso.transaction">CardTransactionManager</a>&nbsp;processClosing()</pre>
<div class="block">Terminates the Secure Session sequence started with <a href="#processOpening(org.calypsonet.terminal.calypso.WriteAccessLevel)"><code>processOpening(WriteAccessLevel)</code></a>.

 <p><b>Nominal case</b>

 <p>The previously prepared commands are integrated into the calculation of the session digest
 by the SAM before execution by the card by anticipating their responses.

 <p>Thus, the session closing command containing the terminal signature is integrated into the
 same APDU group sent to the card via a final card request.

 <p>Upon reception of the response from the card, the signature of the card is verified with the
 SAM.

 <p>If the method terminates normally, it means that the secure session closing and all related
 security checks have been successful; conversely, if one of these operations fails, an
 exception is raised.

 <p><b>Stored Value</b>

 <p>If the SV counter was debited or reloaded during the session, an additional verification
 specific to the SV is performed by the SAM.

 <p><b>Ratification</b>

 <p>A ratification command is added after the close secure session command when the
 communication is done in a contactless mode.

 <p>The logical channel is closed or left open depending on whether the <a href="#prepareReleaseCardChannel()"><code>prepareReleaseCardChannel()</code></a> method has been called before or not.

 <p><b>Card and SAM exchanges in detail</b>

 <ul>
   <li>All the data exchanged with the card so far, to which are added the last prepared orders
       and their anticipated answers, are sent to the SAM for the calculation of the session
       digest. The terminal signature calculation request is also integrated in the same group
       of SAM Apdu.
   <li>All previously prepared commands are sent to the card along with the session closing
       command and possibly the ratification command within a single card request.
   <li>The responses received from the card are integrated into CalypsoCard. <br>
       Note: the reception of the answers of this final card request from the card is tolerant
       to the non-reception of the answer to the ratification order.
   <li>The data received from the card in response to the logout (card session signature and
       possibly SV signature) are sent to the SAM for verification.
 </ul></div>
<dl>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>The current instance.</dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code>java.lang.IllegalStateException</code> - If no session is open.</dd>
<dd><code><a href="CardTransactionException.html" title="class in org.calypsonet.terminal.calypso.transaction">CardTransactionException</a></code> - If a functional error occurs (including card and SAM IO
     errors)</dd>
<dt><span class="simpleTagLabel">Since:</span></dt>
<dd>1.0.0</dd>
</dl>
</li>
</ul>
<a id="processCancel()">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>processCancel</h4>
<pre class="methodSignature"><a href="CardTransactionManager.html" title="interface in org.calypsonet.terminal.calypso.transaction">CardTransactionManager</a>&nbsp;processCancel()</pre>
<div class="block">Aborts a Secure Session.

 <p>Send the appropriate command to the card

 <p>Clean up internal data and status.</div>
<dl>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>The current instance.</dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code>java.lang.IllegalStateException</code> - If no session is open.</dd>
<dd><code><a href="CardTransactionException.html" title="class in org.calypsonet.terminal.calypso.transaction">CardTransactionException</a></code> - If a functional error occurs (including card and SAM IO
     errors)</dd>
<dt><span class="simpleTagLabel">Since:</span></dt>
<dd>1.0.0</dd>
</dl>
</li>
</ul>
</li>
</ul>
</section>
</li>
</ul>
</div>
</div>
</main>
<!-- ========= END OF CLASS DATA ========= -->
<footer role="contentinfo">
<nav role="navigation">
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a id="navbar.bottom">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.bottom" title="Skip navigation links">Skip navigation links</a></div>
<a id="navbar.bottom.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../../index.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="class-use/CardTransactionManager.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../index-all.html">Index</a></li>
<li><a href="../../../../../help-doc.html">Help</a></li>
</ul>
<div class="aboutLanguage">Copyright  Calypso Networks Association https://calypsonet.org/</div>
</div>
<div class="subNav">
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../../../../allclasses.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
<a id="skip.navbar.bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
</nav>
</footer>
</body>
</html>
